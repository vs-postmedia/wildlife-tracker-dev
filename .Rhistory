bcc_data <- read_xlsx('data/bc-conservation/tabula-predatorstatisticsblackbear.xlsx') %>% clean_names()
library(jsonlite)
library(dplyr)
library(readxl)
library(janitor)
library(lubridate)
data <- read.csv('data/encounter-267428-266283.csv')
glimpse(data)
glimpse(warp_data)
warp_data <- fromJSON('data/warp/warp-data-2019.json')
# extract recrods & parse year & month into separate columns
bears <- warp_data$records %>%
mutate(
year = year(encounter_date),
month = month(encounter_date)
)
glimpse(data)
glimpse(bears)
dl_data <- read.csv('data/encounter-267428-266283.csv')
data <- left_join(warp_data, dl_data, by = encounter_id)
data <- left_join(bears, dl_data, by = encounter_id)
View(bears)
View(dl_data)
data <- left_join(bears, dl_data, by = encounter_id)
data <- bears %>% left_join(dl_data, by = 'encounter_id')
View(data)
data <- bears %>% left_join(dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'))
data <- bears %>% left_join(dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'), -ends_with(('.y')))
glimpse(data)
unique(data$group_code)
unique(data$outcome_name)
# outcome lookup table
# outcome_lookup <-
data %>%
select(outcome_name, encounter_outcome_id)
# outcome lookup table
# outcome_lookup <-
data %>%
select(outcome_name, encounter_outcome_id) %>%
group_by(outcome_name)
# outcome lookup table
# outcome_lookup <-
data %>%
select(outcome_name, encounter_outcome_id) %>%
group_by(outcome_name) %>%
count()
# outcome lookup table
# outcome_lookup <-
data %>%
select(outcome_name, encounter_outcome_id) %>%
group_by(outcome_name, encounter_outcome_id) %>%
count()
# outcome lookup table
# outcome_lookup <-
data %>%
# select(outcome_name, encounter_outcome_id) %>%
group_by(outcome_name, encounter_outcome_id) %>%
count() %>%
select(-n)
# outcome lookup table
outcome_lookup <- data %>%
group_by(outcome_name, encounter_outcome_id) %>%
count() %>%
select(-n)
View(outcome_lookup)
# outcome lookup table
outcome_lookup <- data %>%
group_by(outcome_name, encounter_outcome_id) %>%
count() %>%
na.omit() %>%
select(-n)
unique(data$outcome_name)
unique(data$outcome_name) %>% na.omit()
outcome <- unique(data$outcome_name)
outcome
View(output)
View(outcome)
rm(outcome)
glimpse(data)
# encounter type lookup
encounter_lookup <- data %>%
group_by(enctype_name, encounter_enctype_id) %>%
count() %>%
na.omit() %>%
select(-n)
encounter_lookup
source('~/postmedia/wildlife-tracker-dev/scripts/analysis.r', echo=TRUE)
# by attraction
bears %>%
group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 10
) %>%
arrange(-pct)
# by attraction
attr <- bears %>%
group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 10
) %>%
arrange(-pct)
attr
View(attr)
# by attraction
attr <- bears %>%
group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by location
loc <- bears %>%
group_by(encounter_locality) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
View(loc)
rm(loc)
rm(attr)
# by various data subsets
bears %>%
# encounter type
group_by(encounter_enctype) %>%
# outcome
# group_by(encounter_name) %>%
# location
# group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
bears %>%
# encounter type
group_by(enctype_name) %>%
# outcome
# group_by(encounter_name) %>%
# location
# group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type
group_by(enctype_name) %>%
# outcome
# group_by(encounter_name) %>%
# location
# group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 85% NA
# group_by(enctype_name) %>%
# outcome
group_by(encounter_name) %>%
# location
# group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 85% NA
# group_by(enctype_name) %>%
# outcome
group_by(outcome_name) %>%
# location
# group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 85% NA
# group_by(enctype_name) %>%
# outcome - 85% NA
# group_by(outcome_name) %>%
# location
group_by(encounter_locality) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# join so we can create lookup tables for encounter & outcome IDs
data <- bears %>% left_join(dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'))
glimpse(data)
# join so we can create lookup tables for encounter & outcome IDs
data <- full_joint(data, dl_data, by = 'encounter_id')
# join so we can create lookup tables for encounter & outcome IDs
data <- full_join(data, dl_data, by = 'encounter_id')
glimpse(data)
# join so we can create lookup tables for encounter & outcome IDs
data <- full_join(data, dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'))
glimpse(data)
# join so we can create lookup tables for encounter & outcome IDs
data <- full_join(bears, dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'))
glimpse(data)
# join so we can create lookup tables for encounter & outcome IDs
data <- inner_join(warp_data$records, dl_data, by = 'encounter_id') %>%
select(-ends_with('.x'))
glimpse(data)
# by various data subsets
data %>%
# encounter type - 85% NA
group_by(enctype_name) %>%
# outcome - 85% NA
# group_by(outcome_name) %>%
# location
# group_by(encounter_locality,y) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 40% sightings, 35% food conditioned
# group_by(enctype_name) %>%
# outcome - 85% NA
group_by(outcome_name) %>%
# location
# group_by(encounter_locality,y) %>%
# by attraction
# group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 40% sightings, 35% food conditioned
# group_by(enctype_name) %>%
# outcome - 75% Not specified, 15% advice
# group_by(outcome_name) %>%
# location
# group_by(encounter_localityy) %>%
# by attraction
group_by(attractant_names) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 40% sightings, 35% food conditioned
# group_by(enctype_name) %>%
# outcome - 75% Not specified, 15% advice
# group_by(outcome_name) %>%
# location
# group_by(encounter_localityy) %>%
# by attraction
group_by(attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
data %>%
# encounter type - 40% sightings, 35% food conditioned
# group_by(enctype_name) %>%
# outcome - 75% Not specified, 15% advice
# group_by(outcome_name) %>%
# location
group_by(encounter_locality.y) %>%
# by attraction - 56% NA, 25% garbage
# group_by(attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# by various data subsets
loc <- data %>%
# encounter type - 40% sightings, 35% food conditioned
# group_by(enctype_name) %>%
# outcome - 75% Not specified, 15% advice
# group_by(outcome_name) %>%
# location
group_by(encounter_locality.y) %>%
# by attraction - 56% NA, 25% garbage
# group_by(attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
View(loc)
rm(loc)
metro_van <- c(
'Anmore',
'Belcarra',
'Bowen Island',
'Burnaby',
'Coquitlam',
'Delta',
'Electoral Area A',
'Langley',
'Lions Bay',
'Maple Ridge',
'New Westminster',
'North Vancouver',
'Pitt Meadows',
'Port Coquitlam',
'Port Moody',
'Richmond',
'Surrey',
'Tsawwassen',
'Vancouver',
'West Vancouver',
'White Rock'
)
library(R.utils)
?capitalize
??capitalize
metro_van <- c(
'anmore',
'belcarra',
'bowen island',
'burnaby',
'coquitlam',
'Delta',
'electoral area a',
'langley',
'lions bay',
'maple ridge',
'new westminster',
'north Vvancouver',
'pitt meadows',
'port coquitlam',
'port moody',
'richmond',
'surrey',
'tsawwassen',
'vancouver',
'west vancouver',
'White Rock'
)
# METRO
data %>%
filter(
tolower(encounter_locality.y) %in% metro_van
) %>%
group_by(encounter_locality.y, attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-pct)
# METRO
data %>%
filter(
tolower(encounter_locality.y) %in% metro_van
) %>%
group_by(encounter_locality.y, attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
arrange(-total)
# METRO
data %>%
filter(
tolower(encounter_locality.y) %in% metro_van
) %>%
group_by(encounter_locality.y, attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
filter(
attractant_names.y != 'GARBAGE'
) %>%
arrange(-total)
# METRO
data %>%
filter(
tolower(encounter_locality.y) %in% metro_van
) %>%
group_by(encounter_locality.y, attractant_names.y) %>%
summarize(
total = n()
) %>%
mutate(
pct = total/sum(total) * 100
) %>%
filter(
attractant_names.y != 'NOT APPLICABLE'
) %>%
arrange(-total)
